---
import { getLangFromUrl, useTranslations } from "../i18n";
import LanguageSelector from "./react/LanguageSelector";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300 ease-in-out"
  id="header"
>
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo -->
      <div class="flex-shrink-0">
        <a href={lang === "es" ? "/" : "/en"} class="flex items-center">
          <img
            src="/optimized-images/logo-lumia-optimized.webp"
            alt="Lumia"
            class="w-32 h-32"
            loading="lazy"
          />
        </a>
      </div>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center space-x-6">
        <a
          href={lang === "es" ? "/" : "/en"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 hover:font-extrabold"
        >
          {t("nav.home")}
        </a>
        <a
          href={lang === "es" ? "/nosotros" : "/en/about"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 hover:font-extrabold"
        >
          {t("nav.about")}
        </a>
        <a
          href={lang === "es" ? "/servicios" : "/en/services"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 hover:font-extrabold"
        >
          {t("nav.services")}
        </a>
        <a
          href={lang === "es" ? "/galeria" : "/en/gallery"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 hover:font-extrabold"
        >
          {t("nav.gallery")}
        </a>
        <a
          href={lang === "es" ? "/turismo-odontologico" : "/en/dental-tourism"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 hover:font-extrabold"
        >
          {t("nav.dental-tourism")}
        </a>
        <a
          href={lang === "es" ? "/contacto" : "/en/contact"}
          class="text-white hover:text-gray-200 font-medium transition-colors duration-200 underline underline-offset-4 hover:font-extrabold"
        >
          {t("common.schedule-appointment")}
        </a>
      </div>

      <!-- Right side -->
      <div class="flex items-center space-x-3">
        <!-- Language Selector -->
        <div class="language-selector">
          <LanguageSelector lang={lang} client:load />
        </div>

        <!-- Mobile menu button -->
        <button
          class="lg:hidden p-2 rounded-md text-white hover:text-gray-200 hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-white/50 transition-colors duration-200"
          aria-label="Abrir menÃº"
          id="mobile-menu-button"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            id="menu-icon"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
              id="hamburger-icon"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="lg:hidden hidden" id="mobile-menu">
      <div
        class="px-2 pt-2 pb-3 space-y-1 bg-black/80 backdrop-blur-sm border-t border-white/20"
      >
        <a
          href={lang === "es" ? "/" : "/en"}
          class="block px-3 py-2 text-white hover:text-gray-200 hover:bg-white/10 rounded-md font-medium transition-colors duration-200"
        >
          {t("nav.home")}
        </a>
        <a
          href={lang === "es" ? "/nosotros" : "/en/about"}
          class="block px-3 py-2 text-white hover:text-gray-200 hover:bg-white/10 rounded-md font-medium transition-colors duration-200"
        >
          {t("nav.about")}
        </a>
        <a
          href={lang === "es" ? "/servicios" : "/en/services"}
          class="block px-3 py-2 text-white hover:text-gray-200 hover:bg-white/10 rounded-md font-medium transition-colors duration-200"
        >
          {t("nav.services")}
        </a>
        <a
          href={lang === "es" ? "/galeria" : "/en/gallery"}
          class="block px-3 py-2 text-white hover:text-gray-200 hover:bg-white/10 rounded-md font-medium transition-colors duration-200"
        >
          {t("nav.gallery")}
        </a>
        <a
          href={lang === "es" ? "/turismo-odontologico" : "/en/dental-tourism"}
          class="block px-3 py-2 text-white hover:text-gray-200 hover:bg-white/10 rounded-md font-medium transition-colors duration-200"
        >
          {t("nav.dental-tourism")}
        </a>
        <div class="pt-2">
          <a
            href={lang === "es" ? "/contacto" : "/en/contact"}
            class="block mx-3 px-4 py-2 bg-white text-black text-center font-medium rounded-md hover:bg-gray-100 transition-colors duration-200"
          >
            {t("common.schedule-appointment")}
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  /* Header scroll styles */
  .header-scrolled {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  }

  .header-scrolled .text-white {
    color: #000000 !important;
  }

  .header-scrolled .hover\:text-gray-200:hover {
    color: #374151 !important;
  }

  .header-scrolled .hover\:bg-white\/10:hover {
    background-color: rgba(0, 0, 0, 0.05) !important;
  }

  .header-scrolled .focus\:ring-white\/50:focus {
    --tw-ring-color: rgba(0, 0, 0, 0.2) !important;
  }

  .header-scrolled #mobile-menu {
    background: rgba(255, 255, 255, 0.95) !important;
    backdrop-filter: blur(10px);
    border-color: rgba(0, 0, 0, 0.1) !important;
  }

  .header-scrolled #mobile-menu .text-white {
    color: #000000 !important;
  }

  .header-scrolled #mobile-menu .hover\:text-gray-200:hover {
    color: #374151 !important;
  }

  .header-scrolled #mobile-menu .hover\:bg-white\/10:hover {
    background-color: rgba(0, 0, 0, 0.05) !important;
  }
</style>

<script>
  // Mobile menu toggle
  document.addEventListener("DOMContentLoaded", function () {
    const button = document.getElementById("mobile-menu-button");
    const menu = document.getElementById("mobile-menu");
    const icon = document.getElementById("menu-icon");
    const hamburgerIcon = document.getElementById("hamburger-icon");

    if (button && menu && icon && hamburgerIcon) {
      button.addEventListener("click", function () {
        const isHidden = menu.classList.contains("hidden");

        if (isHidden) {
          menu.classList.remove("hidden");
          hamburgerIcon.setAttribute("d", "M6 18L18 6M6 6l12 12"); // X icon
        } else {
          menu.classList.add("hidden");
          hamburgerIcon.setAttribute("d", "M4 6h16M4 12h16M4 18h16"); // Hamburger icon
        }
      });

      // Close mobile menu when clicking outside
      document.addEventListener("click", function (event) {
        const target = event.target as HTMLElement;
        if (!button.contains(target) && !menu.contains(target)) {
          menu.classList.add("hidden");
          hamburgerIcon.setAttribute("d", "M4 6h16M4 12h16M4 18h16");
        }
      });
    }

    // Header scroll behavior
    const header = document.getElementById("header");
    let ticking = false;

    function updateHeader() {
      const scrolled = window.scrollY > 50;

      if (scrolled) {
        header?.classList.add("header-scrolled");
      } else {
        header?.classList.remove("header-scrolled");
      }

      ticking = false;
    }

    function requestTick() {
      if (!ticking) {
        requestAnimationFrame(updateHeader);
        ticking = true;
      }
    }

    if (header) {
      window.addEventListener("scroll", requestTick, { passive: true });

      // Initial check in case page is loaded scrolled
      updateHeader();
    }
  });
</script>
