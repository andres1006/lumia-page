---
export interface Props {
  src: string;
  poster?: string;
  width?: number;
  height?: number;
  class?: string;
  autoplay?: boolean;
  muted?: boolean;
  loop?: boolean;
  controls?: boolean;
  preload?: 'none' | 'metadata' | 'auto';
  playsinline?: boolean;
}

const { 
  src, 
  poster, 
  width, 
  height, 
  class: className, 
  autoplay = false, 
  muted = false, 
  loop = false, 
  controls = true,
  preload = 'metadata',
  playsinline = true
} = Astro.props;

// Generar rutas optimizadas
const baseName = src.replace(/\.[^/.]+$/, '');
const optimizedBasePath = baseName.replace('/img-lumia/Videos/', '/optimized-videos/img-lumia/Videos/');
---

<video
  width={width}
  height={height}
  class={className}
  autoplay={autoplay}
  muted={muted}
  loop={loop}
  controls={controls}
  preload={preload}
  poster={poster || `${optimizedBasePath}-poster.jpg`}
  playsinline={playsinline}
>
  <!-- WebM (mejor compresión, navegadores modernos) -->
  <source 
    src={`${optimizedBasePath}.webm`} 
    type="video/webm"
  />
  
  <!-- MP4 Desktop (alta calidad) -->
  <source 
    src={`${optimizedBasePath}-main.mp4`} 
    type="video/mp4"
    media="(min-width: 768px)"
  />
  
  <!-- MP4 Mobile (optimizado para móviles) -->
  <source 
    src={`${optimizedBasePath}-mobile.mp4`} 
    type="video/mp4"
    media="(max-width: 767px)"
  />
  
  <!-- Fallback al video original -->
  <source src={src} type="video/mp4" />
  
  <p class="video-fallback">
    Tu navegador no soporta el elemento video. 
    <a href={src} download>Descarga el video</a>.
  </p>
</video>

<style>
  video {
    max-width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  video:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
  }
  
  @media (max-width: 768px) {
    video {
      border-radius: 8px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
  }
  
  .video-fallback {
    text-align: center;
    padding: 2rem;
    background: #f8fafc;
    border-radius: 12px;
    color: #64748b;
    font-size: 0.875rem;
  }
</style>
